---
title: 自定义指令
date: 2018-1-30
tags: angular
---

> 今天有需求要做图片查看,需要支持缩放,之前有用过JQ版得的viewer,功能比较齐全.然后发现这个有原生版的,

angular使用第三方库的方法,也弄了一会儿才搞定,还是先来做一下笔记.

- 先安装npm包 `cnpm install viewerjs` 
- 然后需要在`src/styles.less` 中导入css文件
- 在`.angular-cli.json` 文件的scripts 中引入js文件
- 在需要引用的文件中申明一下就可以使用了 `declare var Viewer`  

现在就是学一下怎样写一个自定义指令,不用每次还要手动初始化.

```typescript
import {Directive, ElementRef, HostListener} 
from "@angular/core";

@Directive({
 selector: '[input-trim]'
})
export class InputTrimDirective {
 constructor(public elementRef: ElementRef) {
 }
 @HostListener('keyup', ['$event.target'])
 keyupFun(evt) {
   if (evt.value) {
     this.elementRef.nativeElement.value = evt.value.trim();
   }
 }
}
```

1. @Directive的选择器的值就是可以当属性写在标签中的值,类似`<div input-trim></div>`

2. HostListener 用来为宿主元素添加监听事件

3. 最后要注意在module中声明

4. 如果不使用hostlistener可以使用host

   ```typescript
   import {Directive, ElementRef, HostListener} from "@angular/core";

   @Directive({
   selector: '[input-trim]',
    host: {
   '(keyup)': 'keyupFun($event.target)'
    }
   })
   export class InputTrimDirective {
   constructor(public elementRef: ElementRef) {
   }

   keyupFun(evt) {
   if (evt.value) {
   this.elementRef.nativeElement.value = evt.value.trim();
      }
   }
   }
   ```

   ​

